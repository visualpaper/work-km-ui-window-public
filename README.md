# work-km-ui-window-public

```
# 画面のボタンでタブ/ウィンドウを閉じる件について

## 目的

画面上のボタンでタブ/ウィンドウを閉じられないケースがあるように見受けられた。
(参照) https://qiita.com/heppokofrontend/items/2aaf2c0ca1ce37aa4c45

もし、閉じられないケースがあるのであれば、
想定通りに遷移ができず、機能的に達成したいことができない可能性があるため、
どのようなケースで閉じられないかを明確化したい。


## 調査

* window.open で開いたページ
  -> 消せる
  ※ window.history.length が 1 でなくとも消せた。

* 上記以外 (URL 直打ち、nextjs の router.push などで遷移)
  -> 消せない
  ※ 消せない場合「Scripts may close only the windows that were opened by them.」(スクリプトは、スクリプトによって開かれたウィンドウのみを閉じることができます) というメッセージが表示される。

挙動確認をしてみたところ、上記のような挙動が確認できた。
目的欄にある https://qiita.com/heppokofrontend/items/2aaf2c0ca1ce37aa4c45 ページにあるように、
大前提として JavaScript で開かれたウィンドウであることが重要で、
window.history.length が 1 でなくとも、window.open で開いたものであれば Chrome でも Edge でも普通に消すことができた。

のだが、
本家 (https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-close) を見ると実際にはかなり細かい条件があり、その明確化が困難であることから、
実際のユースケースで、それぞれ実現可能性を見ていかなければ、判断が難しいと思われた。


## 検討

上記の通り、window.open で開いた画面であればおそらく消せるものの、明確化することが難しい。
また、この挙動からユーザ視点で見たときに、やや混乱をまねきかねないケースが起きる可能性があるかもしれない。
※ 例えば、menu から JavaScript で開いた後に閉じることはできるが、開いた後にその URL をコピーして新タブで開いたりすると閉じることができなかったりするので、ユーザ視点で見ると微妙に混乱をまねきかねないようにも思われる。

そのため、できるだけ「閉じる」制御については実装側で制御をかけずに進めていきたい。


## 案

### 1. タブ/ウィンドウを閉じるのではなく、メニュー画面などに遷移する

* メリット
  - 工数がかからない
    ※ タブ/ウィンドウを閉じる制御を実装側で制御をかける必要がなくなる。

* デメリット
  - 既存の挙動を踏襲できない (可能性がある。全てを知らないので)

### 2. 各機能で検証し、タブ/ウィンドウを閉じることができれば閉じる

* メリット
  - 既存の挙動を踏襲できる (可能性がある)

* デメリット
  - 工数がかかる
    ※ 各機能で実現可能性を検証するため工数がかかる。
    ※ タブ/ウィンドウを閉じる制御を実装側で制御をかけるので、実装が複雑化しうる。

※ どちらの案でも、閉じるボタン押下時に注意メッセージを表示することは可能

⇒ 案1 の方針で進めたい。
```
