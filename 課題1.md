# 画面のボタンでタブ/ウィンドウを閉じる件について

## 目的

画面上のボタンでタブ/ウィンドウを閉じられないケースがあるように見受けられた。  
(参照) https://qiita.com/heppokofrontend/items/2aaf2c0ca1ce37aa4c45

もし、閉じられないケースがあるのであれば想定通りに遷移ができず、機能的に達成したいことができない可能性があるため、  
どのようなケースで閉じられないかを明確化したい。

<br><br>

## 調査

[動作検証コード](https://github.com/visualpaper/work-km-ui-window-public/tree/main/app/case1/01)

<br>

* window.open で開いたページ  
  -> 消せる  
  ※ window.history.length が 1 でなくとも消せた。

* 上記以外 (URL 直打ち、nextjs の router.push などで遷移)  
  -> 消せない  
  ※ 消せない場合「Scripts may close only the windows that were opened by them.」(スクリプトは、スクリプトによって開かれたウィンドウのみを閉じることができます) というメッセージが表示される。

<br>

挙動確認をしてみたところ、上記のような挙動が確認できた。  
目的欄にある[参考](https://qiita.com/heppokofrontend/items/2aaf2c0ca1ce37aa4c45)ページにあるように大前提として JavaScript で開かれたウィンドウであることが重要であることがわかる。  
※ 例えば、menu から JavaScript で開いた後に閉じることはできるが、開いた後にその URL をコピーして新タブで開いたりすると (JavaScript で開かれたウィンドウでないので) 閉じることができなかったりする。  
※ 念のため Chrome でも Edge でも確認したが、同様に消すことができた。

のだが、[本家](https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-close) を見ると実際にはかなり細かい条件があり、その明確化が難しいことがわかった。  
※ 単純に知識不足な点もあるが、そもそも条件が複雑すぎて説明できるほど明確化することが現実的でなく、  
   唯一わかることは JavaScript で開かれたウィンドウであればおそらく消すことができるだろうという点のみとなる。

条件の明確化が難しいことから、実際のユースケースで実現可能性を見ていかなければ実現可否の判断は難しいと思われる。

<br><br>

## 検討

上記の通り、window.open で開いた画面であればおそらく消せるものの、本当にそうなのかを明確化することが難しい。  
といって、全機能で実現可能性を検証するには工数がかかりすぎると思われる。  
そのため、できるだけ「閉じる」制御については実装側で制御をかけない方針で進めていきたい。

<br><br>

## 案

### 1. タブ/ウィンドウを閉じるのではなく、メニュー画面などに遷移する

* メリット
  - 工数がかからない  
    ※ タブ/ウィンドウを閉じる制御を実装側で制御をかける必要がなくなる。

* デメリット
  - 既存の挙動を踏襲できない (可能性がある。全てを知らないので)

<br>

### 2. 各機能で検証し、タブ/ウィンドウを閉じることができれば閉じる

* メリット
  - 既存の挙動を踏襲できる (可能性がある)

* デメリット
  - 工数がかかる  
    ※ 各機能で実現可能性を検証するため工数がかかる。  
    ※ タブ/ウィンドウを閉じる制御を実装側で制御をかけるので、実装が複雑化しうる。

※ どちらの案でも、閉じるボタン押下時に注意メッセージを表示することは可能

<br><br>

<b> ⇒ 案1 の方針で進めたい。 </b>
